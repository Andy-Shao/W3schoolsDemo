<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" href="../resources/css/note.css">
</head>
<body>
<p>An SQL Injection can destroy your database.</p>
<h1>SQL in Web Pages</h1>
<p>In the previous chapters, you have learned to retrieve (and update) database data, using SQL.</p>
<p>When SQL is used to display data on a web page, it is common to let web users input their own search
values.</p>
<p>Since SQL statements are text only, it is easy, with a little piece of computer code, to dynamically
change SQL statements to provide the user with selected data:</p>\
<code>
txtUserId = getRequestString("UserId");
txtSQL = "SELECT * FROM Users WHERE UserId =" + txtUserId; 
</code>
<p>
The example above, create a select statement by adding a variable(txtUserId) to a select string. The 
variable is fetched from the user input(Request) to the page.
</p>
<p>The rest of this chapter describe the potential dangers of using user input in SQL statements.</p>
<hr/>

<h1>SQL Injection</h1>
<p>
SQL injection is a technique where malicious users can inject SQL commands into an SQL statement, via
web page input.
</p>
<p>Injected SQL commands can alter SQL statement and compromise the security of a web application</p>
<hr/>

<h1>SQL Injection Based on 1=1 is Always True</h1>
<p>Look at the example above, one more time.</p>
<p>Let's say that the original purpose of the code was to create an SQL statement to select a user 
with a given user id.</p>
<p>If there is nothing to prevent a user from entering "wrong" input, the user can enter some "smart"
input like this:</p>
<label>UserId:</label>
<input type="text" value="105 or 1=1" style="width: 500px;"/>
<div class="form">
SELECT * FROM Users WHERE UserId = 105 or 1=1;
</div>
<p>The SQL above is valid. It will return all rows from the table Users, since <b>WHERE 1=1</b> is 
always true.</p>
<p>Does the example above seem dangerous? What if the Users table contains names and passwords?</p>
<p>The SQL statement above is much the same as this:</p>
<div class="form">
SELECT UserId, Name, Password FROM Users WHERE UserId=105 or 1=1
</div>
<p>A smart hacker might get access to all the user names and paswords in a database by simply inserting
105 or 1=1 into the input box.</p>
<hr/>

<h1>SQL Injection Based on ""="" is ALways True</h1>
<p>Here is a common construction, used to verify user login to a web site:</p>
<label>User Name:</label>
<input style="width: 500px;" type="text" value=""/>
<label>Password:</label>
<input style="width: 500px;" type="text" value=""/>
<code>
uName = getRequestString("UserName");
uPass = getRequestString("UserPass");

sql = "SELECT * FROM Users WHERE Name = '" + uName + "' AND Pass='" + uPass + "'" 
</code>
<p>A smart hacker might get access to user names and paswords in a database by simply inserting "or ""=
into the user name or password text box.</p>
<p>The code at the server will create a valid SQL statement like this:</p>
<div class="form">
SELECT * FROM Users WHERE Name="" or ""="" AND Pass ="" or ""=""
</div>
<p>The result SQL is valid. It will return all rows from the table Users, since <b>WHERE ""=""</b> is
always true.</p>
<hr/>

<h1>SQL Injection Based on Batched SQL Statements</h1>
<p>Most databases support batched SQL statement, separated by semicolon.</p>
<div class="form">
SELECT * FROM Users; DROP TABLE Suppliers
</div>
<p>The SQL above will return will rows in the Users table, and then delete the table called Suppliers.</p>
<p>If we had the following server code:</p>
<code>
txtUserId = getRequestString("UserId");
txtSQL = "SELECT * FROM Users WHERE UserId=" + txtUserId;
</code>
<p>And the following input:</p>
<label>User id:</label>
<input style="width: 500px;" type="text" value="105; DROP TABLE Suppliers"/>
<p>The code at the server would create a valid SQL statement like this:</p>
<div class="form">
SELECT * FROM Users WHERE UserId = 105; DROP TABLE Suppliers
</div>
<hr/>

<h1>Parameters for Protection</h1>
<p>Some web developers use a "blacklist" of words of characters to search for in SQL input, 
to prevent SQL injection attacks.</p>
<p>This is not a very good idea. Many of these words (like delete or drop) and characters (like semicolons
and quotation marks), are used in common language, and should be allowed in many types of input.</p>
<p>(In fact it should be perfectly legal to input an SQL statement in a database field.)</p>
<p>The only proven way to protect a web site from SQL injection attacks, is to use SQL parameters.</p>
<p>SQL parameters are values that are added to an SQL query at execution time, in a controlled manner.</p>
</body>
</html>